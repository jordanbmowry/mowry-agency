<template>
  <SimpleLayout
    title="Schedule Your Interview"
    intro="Ready to learn more about building a successful career with Mowry Agency and Symmetry Financial Group? Watch the required training videos below, then schedule your interview."
  >
    <!-- SFG Partnership Section -->
    <div class="mb-16">
      <div
        class="rounded-2xl border border-zinc-100 bg-zinc-50 p-8 dark:border-zinc-700/40 dark:bg-zinc-800/50"
      >
        <div class="text-center">
          <h2
            class="text-2xl font-bold tracking-tight text-zinc-800 sm:text-3xl dark:text-zinc-100 mb-4"
          >
            Mowry Agency is a proud partner of
          </h2>
          <h3 class="text-3xl font-bold text-teal-600 dark:text-teal-400 mb-6">
            Symmetry Financial Group (SFG)
          </h3>
          <p class="text-lg text-zinc-600 dark:text-zinc-400 max-w-3xl mx-auto">
            As part of the SFG network, we provide our agents with
            industry-leading training, proven systems, and the support needed to
            build a thriving insurance career.
          </p>
        </div>
      </div>
    </div>

    <!-- Required Training Videos -->
    <div class="mb-16">
      <div class="text-center mb-12">
        <h2
          class="text-2xl font-bold tracking-tight text-zinc-800 sm:text-3xl dark:text-zinc-100 mb-4"
        >
          Required Training Videos
        </h2>
        <div
          class="bg-amber-50 border-l-4 border-amber-400 p-4 mb-8 dark:bg-amber-900/20 dark:border-amber-500"
        >
          <div class="flex">
            <div class="flex-shrink-0">
              <Icon
                name="heroicons:exclamation-triangle"
                class="h-5 w-5 text-amber-400"
              />
            </div>
            <div class="ml-3">
              <p class="text-sm text-amber-700 dark:text-amber-200">
                <strong>Important:</strong> Watching all videos below is
                required before your interview. This training will help ensure a
                successful and productive conversation about your career
                opportunity.
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Video Grid -->
      <div class="grid grid-cols-1 gap-8 lg:grid-cols-2">
        <!-- Video 1 -->
        <div class="space-y-4">
          <div
            class="aspect-video rounded-lg overflow-hidden bg-zinc-100 dark:bg-zinc-800"
          >
            <iframe
              src="https://sfglife.wistia.com/embed/iframe/hq93qhw1t4"
              title="SFG Training Video 1"
              allow="autoplay; fullscreen"
              allowtransparency="true"
              frameborder="0"
              scrolling="no"
              class="w-full h-full"
              name="wistia_embed"
              msallowfullscreen
              webkitallowfullscreen
              allowfullscreen
            ></iframe>
          </div>
          <h3 class="text-lg font-semibold text-zinc-900 dark:text-zinc-100">
            Video 1: SFG Overview
          </h3>
        </div>

        <!-- Video 2 -->
        <div class="space-y-4">
          <div
            class="aspect-video rounded-lg overflow-hidden bg-zinc-100 dark:bg-zinc-800"
          >
            <iframe
              src="https://sfglife.wistia.com/embed/iframe/f1r12pibj7"
              title="SFG Training Video 2"
              allow="autoplay; fullscreen"
              allowtransparency="true"
              frameborder="0"
              scrolling="no"
              class="w-full h-full"
              name="wistia_embed"
              msallowfullscreen
              webkitallowfullscreen
              allowfullscreen
            ></iframe>
          </div>
          <h3 class="text-lg font-semibold text-zinc-900 dark:text-zinc-100">
            Video 2: Career Opportunity
          </h3>
        </div>

        <!-- Video 3 -->
        <div class="space-y-4">
          <div
            class="aspect-video rounded-lg overflow-hidden bg-zinc-100 dark:bg-zinc-800"
          >
            <iframe
              src="https://sfglife.wistia.com/embed/iframe/zv59mrjo4w"
              title="SFG Training Video 3"
              allow="autoplay; fullscreen"
              allowtransparency="true"
              frameborder="0"
              scrolling="no"
              class="w-full h-full"
              name="wistia_embed"
              msallowfullscreen
              webkitallowfullscreen
              allowfullscreen
            ></iframe>
          </div>
          <h3 class="text-lg font-semibold text-zinc-900 dark:text-zinc-100">
            Video 3: Training & Support
          </h3>
        </div>

        <!-- Video 4 -->
        <div class="space-y-4">
          <div
            class="aspect-video rounded-lg overflow-hidden bg-zinc-100 dark:bg-zinc-800"
          >
            <iframe
              src="https://sfglife.wistia.com/embed/iframe/cow05leruj"
              title="SFG Training Video 4"
              allow="autoplay; fullscreen"
              allowtransparency="true"
              frameborder="0"
              scrolling="no"
              class="w-full h-full"
              name="wistia_embed"
              msallowfullscreen
              webkitallowfullscreen
              allowfullscreen
            ></iframe>
          </div>
          <h3 class="text-lg font-semibold text-zinc-900 dark:text-zinc-100">
            Video 4: Success Stories
          </h3>
        </div>

        <!-- Video 5 -->
        <div class="space-y-4">
          <div
            class="aspect-video rounded-lg overflow-hidden bg-zinc-100 dark:bg-zinc-800"
          >
            <iframe
              src="https://sfglife.wistia.com/embed/iframe/kvh8pp0do1"
              title="SFG Training Video 5"
              allow="autoplay; fullscreen"
              allowtransparency="true"
              frameborder="0"
              scrolling="no"
              class="w-full h-full"
              name="wistia_embed"
              msallowfullscreen
              webkitallowfullscreen
              allowfullscreen
            ></iframe>
          </div>
          <h3 class="text-lg font-semibold text-zinc-900 dark:text-zinc-100">
            Video 5: Income Potential
          </h3>
        </div>

        <!-- Video 6 -->
        <div class="space-y-4">
          <div
            class="aspect-video rounded-lg overflow-hidden bg-zinc-100 dark:bg-zinc-800"
          >
            <iframe
              src="https://sfglife.wistia.com/embed/iframe/5a31uqs1gj"
              title="SFG Training Video 6"
              allow="autoplay; fullscreen"
              allowtransparency="true"
              frameborder="0"
              scrolling="no"
              class="w-full h-full"
              name="wistia_embed"
              msallowfullscreen
              webkitallowfullscreen
              allowfullscreen
            ></iframe>
          </div>
          <h3 class="text-lg font-semibold text-zinc-900 dark:text-zinc-100">
            Video 6: Getting Started
          </h3>
        </div>
      </div>
    </div>

    <!-- Progress Tracker -->
    <div class="mb-16">
      <div
        class="rounded-2xl border border-zinc-100 bg-zinc-50 p-8 dark:border-zinc-700/40 dark:bg-zinc-800/50"
      >
        <h3
          class="text-xl font-semibold text-zinc-900 dark:text-zinc-100 mb-4 text-center"
        >
          Training Progress
        </h3>
        <div class="grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-6">
          <div
            v-for="(video, index) in videos"
            :key="index"
            class="text-center"
          >
            <div
              class="mx-auto h-12 w-12 rounded-full flex items-center justify-center mb-2"
              :class="
                video.watched
                  ? 'bg-green-100 dark:bg-green-900'
                  : 'bg-zinc-200 dark:bg-zinc-700'
              "
            >
              <Icon
                :name="video.watched ? 'heroicons:check' : 'heroicons:play'"
                class="h-6 w-6"
                :class="
                  video.watched
                    ? 'text-green-600 dark:text-green-400'
                    : 'text-zinc-400'
                "
              />
            </div>
            <p
              class="text-sm font-medium"
              :class="
                video.watched
                  ? 'text-green-600 dark:text-green-400'
                  : 'text-zinc-500'
              "
            >
              Video {{ index + 1 }}
            </p>
          </div>
        </div>
        <div class="mt-6 text-center">
          <p class="text-sm text-zinc-600 dark:text-zinc-400">
            <span class="font-semibold"
              >{{ watchedCount }}/{{ videos.length }}</span
            >
            videos completed
          </p>
        </div>
      </div>
    </div>

    <!-- Schedule Interview Button -->
    <div class="text-center">
      <div
        v-if="!allVideosWatched"
        class="mb-6 p-4 bg-amber-50 rounded-lg border border-amber-200 dark:bg-amber-900/20 dark:border-amber-800"
      >
        <p class="text-amber-700 dark:text-amber-300">
          Please watch all {{ videos.length }} training videos before scheduling
          your interview.
        </p>
      </div>

      <button
        v-if="allVideosWatched"
        @click="scheduleInterview"
        class="inline-flex items-center px-8 py-4 text-lg font-semibold text-white bg-teal-600 rounded-lg hover:bg-teal-700 transition-colors duration-200 shadow-lg cursor-pointer"
      >
        Schedule Your Interview
      </button>

      <button
        v-else
        disabled
        class="inline-flex items-center px-8 py-4 text-lg font-semibold text-zinc-400 bg-zinc-200 rounded-lg cursor-not-allowed dark:bg-zinc-700 dark:text-zinc-500"
      >
        Complete Training to Schedule Interview
      </button>
    </div>
  </SimpleLayout>
</template>

<script setup lang="ts">
import SimpleLayout from '~/components/SimpleLayout.vue';

// Set page metadata
useSeoMeta({
  title: 'Schedule Interview - Mowry Agency | SFG Career Opportunity',
  description:
    'Complete the required training videos and schedule your interview to start your insurance career with Mowry Agency and Symmetry Financial Group.',
  ogTitle: 'Schedule Interview - Mowry Agency | SFG Career Opportunity',
  ogDescription:
    'Watch required training videos and schedule your interview for an exciting career opportunity with SFG.',
});

// Video tracking state
const videos = ref([
  { id: 'hq93qhw1t4', watched: false },
  { id: 'f1r12pibj7', watched: false },
  { id: 'zv59mrjo4w', watched: false },
  { id: 'cow05leruj', watched: false },
  { id: 'kvh8pp0do1', watched: false },
  { id: '5a31uqs1gj', watched: false },
]);

// Computed properties
const watchedCount = computed(
  () => videos.value.filter((v) => v.watched).length
);
const allVideosWatched = computed(() => videos.value.every((v) => v.watched));

// Video tracking using Wistia API
onMounted(() => {
  // Load Wistia API
  const script = document.createElement('script');
  script.src = 'https://fast.wistia.com/assets/external/E-v1.js';
  script.async = true;
  document.head.appendChild(script);

  script.onload = () => {
    // Track video completion
    videos.value.forEach((video, index) => {
      if (window.Wistia) {
        window.Wistia.api(video.id, (videoApi: any) => {
          videoApi.bind('end', () => {
            videos.value[index].watched = true;
            // Save progress to localStorage
            localStorage.setItem(
              'sfg-training-progress',
              JSON.stringify(videos.value)
            );
          });
        });
      }
    });
  };

  // Load saved progress
  const savedProgress = localStorage.getItem('sfg-training-progress');
  if (savedProgress) {
    try {
      const progress = JSON.parse(savedProgress);
      videos.value = progress;
    } catch (e) {
      // Could not load saved progress - this is expected for first-time users
    }
  }
});

// Schedule interview function
const scheduleInterview = () => {
  if (allVideosWatched.value) {
    window.open(
      'https://calendly.com/mowry-agency/symmetry-interview',
      '_blank'
    );
  }
};

// Global type declaration for Wistia
declare global {
  interface Window {
    Wistia: any;
  }
}
</script>
